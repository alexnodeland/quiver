(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();let _;function V(n){const e=_.__externref_table_alloc();return _.__wbindgen_externrefs.set(e,n),e}function L(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const r=n.description;return r==null?"Symbol":`Symbol(${r})`}if(e=="function"){const r=n.name;return typeof r=="string"&&r.length>0?`Function(${r})`:"Function"}if(Array.isArray(n)){const r=n.length;let i="[";r>0&&(i+=L(n[0]));for(let c=1;c<r;c++)i+=", "+L(n[c]);return i+="]",i}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let o;if(t&&t.length>1)o=t[1];else return toString.call(n);if(o=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:o}function Q(n,e){return n=n>>>0,X().subarray(n/8,n/8+e)}function K(n,e){return n=n>>>0,E().subarray(n/1,n/1+e)}let m=null;function d(){return(m===null||m.buffer.detached===!0||m.buffer.detached===void 0&&m.buffer!==_.memory.buffer)&&(m=new DataView(_.memory.buffer)),m}let A=null;function X(){return(A===null||A.byteLength===0)&&(A=new Float64Array(_.memory.buffer)),A}function F(n,e){return n=n>>>0,H(n,e)}let S=null;function E(){return(S===null||S.byteLength===0)&&(S=new Uint8Array(_.memory.buffer)),S}function O(n,e){try{return n.apply(this,e)}catch(t){const o=V(t);_.__wbindgen_exn_store(o)}}function k(n){return n==null}function g(n,e,t){if(t===void 0){const a=x.encode(n),b=e(a.length,1)>>>0;return E().subarray(b,b+a.length).set(a),l=a.length,b}let o=n.length,r=e(o,1)>>>0;const i=E();let c=0;for(;c<o;c++){const a=n.charCodeAt(c);if(a>127)break;i[r+c]=a}if(c!==o){c!==0&&(n=n.slice(c)),r=t(r,o,o=c+n.length*3,1)>>>0;const a=E().subarray(r+c,r+o),b=x.encodeInto(n,a);c+=b.written,r=t(r,o,c,1)>>>0}return l=c,r}function s(n){const e=_.__wbindgen_externrefs.get(n);return _.__externref_table_dealloc(n),e}let I=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});I.decode();const Y=2146435072;let B=0;function H(n,e){return B+=e,B>=Y&&(I=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),I.decode(),B=e),I.decode(E().subarray(n,n+e))}const x=new TextEncoder;"encodeInto"in x||(x.encodeInto=function(n,e){const t=x.encode(n);return e.set(t),{read:n.length,written:t.length}});let l=0;const W=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>_.__wbg_quiverengine_free(n>>>0,1));typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>_.__wbg_quivererror_free(n>>>0,1));class N{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,W.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_quiverengine_free(e,0)}constructor(e){const t=_.quiverengine_new(e);return this.__wbg_ptr=t>>>0,W.register(this,this.__wbg_ptr,this),this}get sample_rate(){return _.quiverengine_sample_rate(this.__wbg_ptr)}get_catalog(){const e=_.quiverengine_get_catalog(this.__wbg_ptr);if(e[2])throw s(e[1]);return s(e[0])}search_modules(e){const t=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),o=l,r=_.quiverengine_search_modules(this.__wbg_ptr,t,o);if(r[2])throw s(r[1]);return s(r[0])}get_modules_by_category(e){const t=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),o=l,r=_.quiverengine_get_modules_by_category(this.__wbg_ptr,t,o);if(r[2])throw s(r[1]);return s(r[0])}get_categories(){const e=_.quiverengine_get_categories(this.__wbg_ptr);if(e[2])throw s(e[1]);return s(e[0])}get_signal_colors(){const e=_.quiverengine_get_signal_colors(this.__wbg_ptr);if(e[2])throw s(e[1]);return s(e[0])}check_compatibility(e,t){const o=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=l,i=g(t,_.__wbindgen_malloc,_.__wbindgen_realloc),c=l,a=_.quiverengine_check_compatibility(this.__wbg_ptr,o,r,i,c);if(a[2])throw s(a[1]);return s(a[0])}load_patch(e){const t=_.quiverengine_load_patch(this.__wbg_ptr,e);if(t[1])throw s(t[0])}save_patch(e){const t=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),o=l,r=_.quiverengine_save_patch(this.__wbg_ptr,t,o);if(r[2])throw s(r[1]);return s(r[0])}validate_patch(e){const t=_.quiverengine_validate_patch(this.__wbg_ptr,e);if(t[2])throw s(t[1]);return s(t[0])}clear_patch(){_.quiverengine_clear_patch(this.__wbg_ptr)}add_module(e,t){const o=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=l,i=g(t,_.__wbindgen_malloc,_.__wbindgen_realloc),c=l,a=_.quiverengine_add_module(this.__wbg_ptr,o,r,i,c);if(a[1])throw s(a[0])}remove_module(e){const t=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),o=l,r=_.quiverengine_remove_module(this.__wbg_ptr,t,o);if(r[1])throw s(r[0])}set_module_position(e,t,o){const r=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=l,c=_.quiverengine_set_module_position(this.__wbg_ptr,r,i,t,o);if(c[1])throw s(c[0])}get_module_position(e){const t=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),o=l,r=_.quiverengine_get_module_position(this.__wbg_ptr,t,o);if(r[2])throw s(r[1]);return s(r[0])}module_count(){return _.quiverengine_module_count(this.__wbg_ptr)>>>0}cable_count(){return _.quiverengine_cable_count(this.__wbg_ptr)>>>0}set_output(e){const t=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),o=l,r=_.quiverengine_set_output(this.__wbg_ptr,t,o);if(r[1])throw s(r[0])}connect(e,t){const o=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=l,i=g(t,_.__wbindgen_malloc,_.__wbindgen_realloc),c=l,a=_.quiverengine_connect(this.__wbg_ptr,o,r,i,c);if(a[1])throw s(a[0])}connect_attenuated(e,t,o){const r=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=l,c=g(t,_.__wbindgen_malloc,_.__wbindgen_realloc),a=l,b=_.quiverengine_connect_attenuated(this.__wbg_ptr,r,i,c,a,o);if(b[1])throw s(b[0])}connect_modulated(e,t,o,r){const i=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),c=l,a=g(t,_.__wbindgen_malloc,_.__wbindgen_realloc),b=l,v=_.quiverengine_connect_modulated(this.__wbg_ptr,i,c,a,b,o,r);if(v[1])throw s(v[0])}disconnect_by_index(e){const t=_.quiverengine_disconnect_by_index(this.__wbg_ptr,e);if(t[1])throw s(t[0])}disconnect(e,t){const o=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=l,i=g(t,_.__wbindgen_malloc,_.__wbindgen_realloc),c=l,a=_.quiverengine_disconnect(this.__wbg_ptr,o,r,i,c);if(a[1])throw s(a[0])}get_module_names(){const e=_.quiverengine_get_module_names(this.__wbg_ptr);if(e[2])throw s(e[1]);return s(e[0])}get_params(e){const t=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),o=l,r=_.quiverengine_get_params(this.__wbg_ptr,t,o);if(r[2])throw s(r[1]);return s(r[0])}set_param(e,t,o){const r=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=l,c=_.quiverengine_set_param(this.__wbg_ptr,r,i,t,o);if(c[1])throw s(c[0])}get_param(e,t){const o=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=l,i=_.quiverengine_get_param(this.__wbg_ptr,o,r,t);if(i[2])throw s(i[1]);return i[0]}set_param_by_name(e,t,o){const r=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=l,c=g(t,_.__wbindgen_malloc,_.__wbindgen_realloc),a=l,b=_.quiverengine_set_param_by_name(this.__wbg_ptr,r,i,c,a,o);if(b[1])throw s(b[0])}subscribe(e){const t=_.quiverengine_subscribe(this.__wbg_ptr,e);if(t[1])throw s(t[0])}unsubscribe(e){const t=_.quiverengine_unsubscribe(this.__wbg_ptr,e);if(t[1])throw s(t[0])}clear_subscriptions(){_.quiverengine_clear_subscriptions(this.__wbg_ptr)}poll_updates(){const e=_.quiverengine_poll_updates(this.__wbg_ptr);if(e[2])throw s(e[1]);return s(e[0])}pending_update_count(){return _.quiverengine_pending_update_count(this.__wbg_ptr)>>>0}tick(){const e=_.quiverengine_tick(this.__wbg_ptr);var t=Q(e[0],e[1]).slice();return _.__wbindgen_free(e[0],e[1]*8,8),t}process_block(e){return _.quiverengine_process_block(this.__wbg_ptr,e)}reset(){_.quiverengine_reset(this.__wbg_ptr)}compile(){const e=_.quiverengine_compile(this.__wbg_ptr);if(e[1])throw s(e[0])}midi_note_on(e,t){const o=_.quiverengine_midi_note_on(this.__wbg_ptr,e,t);if(o[1])throw s(o[0])}midi_note_off(e,t){const o=_.quiverengine_midi_note_off(this.__wbg_ptr,e,t);if(o[1])throw s(o[0])}get midi_note(){return _.quiverengine_midi_note(this.__wbg_ptr)}get midi_velocity(){return _.quiverengine_midi_velocity(this.__wbg_ptr)}get midi_gate(){return _.quiverengine_midi_gate(this.__wbg_ptr)!==0}midi_cc(e,t){const o=_.quiverengine_midi_cc(this.__wbg_ptr,e,t);if(o[1])throw s(o[0])}get_midi_cc(e){return _.quiverengine_get_midi_cc(this.__wbg_ptr,e)}midi_pitch_bend(e){const t=_.quiverengine_midi_pitch_bend(this.__wbg_ptr,e);if(t[1])throw s(t[0])}get pitch_bend(){return _.quiverengine_pitch_bend(this.__wbg_ptr)}get_port_spec(e){const t=g(e,_.__wbindgen_malloc,_.__wbindgen_realloc),o=l,r=_.quiverengine_get_port_spec(this.__wbg_ptr,t,o);if(r[2])throw s(r[1]);return s(r[0])}}Symbol.dispose&&(N.prototype[Symbol.dispose]=N.prototype.free);const J=new Set(["basic","cors","default"]);async function G(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(o){if(n.ok&&J.has(n.type)&&n.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function Z(){const n={};return n.wbg={},n.wbg.__wbg_Error_52673b7de5a0ca89=function(e,t){return Error(F(e,t))},n.wbg.__wbg_Number_2d1dcfcf4ec51736=function(e){return Number(e)},n.wbg.__wbg_String_8f0eb39a4a4c2f66=function(e,t){const o=String(t),r=g(o,_.__wbindgen_malloc,_.__wbindgen_realloc),i=l;d().setInt32(e+4*1,i,!0),d().setInt32(e+4*0,r,!0)},n.wbg.__wbg___wbindgen_bigint_get_as_i64_6e32f5e6aff02e1d=function(e,t){const o=t,r=typeof o=="bigint"?o:void 0;d().setBigInt64(e+8*1,k(r)?BigInt(0):r,!0),d().setInt32(e+4*0,!k(r),!0)},n.wbg.__wbg___wbindgen_boolean_get_dea25b33882b895b=function(e){const t=e,o=typeof t=="boolean"?t:void 0;return k(o)?16777215:o?1:0},n.wbg.__wbg___wbindgen_debug_string_adfb662ae34724b6=function(e,t){const o=L(t),r=g(o,_.__wbindgen_malloc,_.__wbindgen_realloc),i=l;d().setInt32(e+4*1,i,!0),d().setInt32(e+4*0,r,!0)},n.wbg.__wbg___wbindgen_in_0d3e1e8f0c669317=function(e,t){return e in t},n.wbg.__wbg___wbindgen_is_bigint_0e1a2e3f55cfae27=function(e){return typeof e=="bigint"},n.wbg.__wbg___wbindgen_is_function_8d400b8b1af978cd=function(e){return typeof e=="function"},n.wbg.__wbg___wbindgen_is_object_ce774f3490692386=function(e){const t=e;return typeof t=="object"&&t!==null},n.wbg.__wbg___wbindgen_is_string_704ef9c8fc131030=function(e){return typeof e=="string"},n.wbg.__wbg___wbindgen_is_undefined_f6b95eab589e0269=function(e){return e===void 0},n.wbg.__wbg___wbindgen_jsval_eq_b6101cc9cef1fe36=function(e,t){return e===t},n.wbg.__wbg___wbindgen_jsval_loose_eq_766057600fdd1b0d=function(e,t){return e==t},n.wbg.__wbg___wbindgen_number_get_9619185a74197f95=function(e,t){const o=t,r=typeof o=="number"?o:void 0;d().setFloat64(e+8*1,k(r)?0:r,!0),d().setInt32(e+4*0,!k(r),!0)},n.wbg.__wbg___wbindgen_string_get_a2a31e16edf96e42=function(e,t){const o=t,r=typeof o=="string"?o:void 0;var i=k(r)?0:g(r,_.__wbindgen_malloc,_.__wbindgen_realloc),c=l;d().setInt32(e+4*1,c,!0),d().setInt32(e+4*0,i,!0)},n.wbg.__wbg___wbindgen_throw_dd24417ed36fc46e=function(e,t){throw new Error(F(e,t))},n.wbg.__wbg_call_abb4ff46ce38be40=function(){return O(function(e,t){return e.call(t)},arguments)},n.wbg.__wbg_done_62ea16af4ce34b24=function(e){return e.done},n.wbg.__wbg_entries_83c79938054e065f=function(e){return Object.entries(e)},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let o,r;try{o=e,r=t,console.error(F(e,t))}finally{_.__wbindgen_free(o,r,1)}},n.wbg.__wbg_get_6b7bd52aca3f9671=function(e,t){return e[t>>>0]},n.wbg.__wbg_get_af9dab7e9603ea93=function(){return O(function(e,t){return Reflect.get(e,t)},arguments)},n.wbg.__wbg_get_with_ref_key_1dc361bd10053bfe=function(e,t){return e[t]},n.wbg.__wbg_instanceof_ArrayBuffer_f3320d2419cd0355=function(e){let t;try{t=e instanceof ArrayBuffer}catch{t=!1}return t},n.wbg.__wbg_instanceof_Map_084be8da74364158=function(e){let t;try{t=e instanceof Map}catch{t=!1}return t},n.wbg.__wbg_instanceof_Uint8Array_da54ccc9d3e09434=function(e){let t;try{t=e instanceof Uint8Array}catch{t=!1}return t},n.wbg.__wbg_isArray_51fd9e6422c0a395=function(e){return Array.isArray(e)},n.wbg.__wbg_isSafeInteger_ae7d3f054d55fa16=function(e){return Number.isSafeInteger(e)},n.wbg.__wbg_iterator_27b7c8b35ab3e86b=function(){return Symbol.iterator},n.wbg.__wbg_length_22ac23eaec9d8053=function(e){return e.length},n.wbg.__wbg_length_d45040a40c570362=function(e){return e.length},n.wbg.__wbg_new_1ba21ce319a06297=function(){return new Object},n.wbg.__wbg_new_25f239778d6112b9=function(){return new Array},n.wbg.__wbg_new_6421f6084cc5bc5a=function(e){return new Uint8Array(e)},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},n.wbg.__wbg_new_b546ae120718850e=function(){return new Map},n.wbg.__wbg_new_with_length_95ba657dfb7d3dfb=function(e){return new Float32Array(e>>>0)},n.wbg.__wbg_next_138a17bbf04e926c=function(e){return e.next},n.wbg.__wbg_next_3cfe5c0fe2a4cc53=function(){return O(function(e){return e.next()},arguments)},n.wbg.__wbg_prototypesetcall_dfe9b766cdc1f1fd=function(e,t,o){Uint8Array.prototype.set.call(K(e,t),o)},n.wbg.__wbg_set_3f1d0b984ed272ed=function(e,t,o){e[t]=o},n.wbg.__wbg_set_7df433eea03a5c14=function(e,t,o){e[t>>>0]=o},n.wbg.__wbg_set_efaaf145b9377369=function(e,t,o){return e.set(t,o)},n.wbg.__wbg_set_index_165b46b0114d368c=function(e,t,o){e[t>>>0]=o},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){const o=t.stack,r=g(o,_.__wbindgen_malloc,_.__wbindgen_realloc),i=l;d().setInt32(e+4*1,i,!0),d().setInt32(e+4*0,r,!0)},n.wbg.__wbg_value_57b7b035e117f7ee=function(e){return e.value},n.wbg.__wbindgen_cast_2241b6af4c4b2941=function(e,t){return F(e,t)},n.wbg.__wbindgen_cast_4625c577ab2ec9ee=function(e){return BigInt.asUintN(64,e)},n.wbg.__wbindgen_cast_9ae0607507abb057=function(e){return e},n.wbg.__wbindgen_cast_d6cd19b81560fd6e=function(e){return e},n.wbg.__wbindgen_init_externref_table=function(){const e=_.__wbindgen_externrefs,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},n}function ee(n,e){return _=n.exports,U.__wbindgen_wasm_module=e,m=null,A=null,S=null,_.__wbindgen_start(),_}async function U(n){if(_!==void 0)return _;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL("/assets/quiver_bg-kAUMxgrR.wasm",import.meta.url));const e=Z();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:o}=await G(await n,e);return ee(t,o)}let u=null,w=null,P=null,T=!1,h=new Set,R="saw";const j={saw:"osc.saw",pulse:"osc.sqr",tri:"osc.tri",sine:"osc.sin"};function te(n){if(!u||n===R)return;const e=j[R],t=j[n];if(!(!e||!t))try{u.disconnect(e,"filter.in"),u.connect(t,"filter.in"),u.compile(),R=n,console.log("Switched waveform to:",n)}catch(o){console.error("Failed to switch waveform:",o)}}const y=document.getElementById("status"),C=document.getElementById("start"),p=document.getElementById("scope"),f=p.getContext("2d");let q=new Float32Array(256),M=0;async function ne(){try{await U(),y.className="status ready",y.textContent='WASM loaded - Click "Start Audio" to begin',C.disabled=!1}catch(n){y.className="status error",y.textContent=`Failed to load WASM: ${n.message}`,console.error("WASM init failed:",n)}}function re(n){const e=(i,c)=>{console.log(`Adding module: ${i} as "${c}"`),n.add_module(i,c)},t=(i,c)=>{console.log(`Connecting: ${i} -> ${c}`),n.connect(i,c)};e("vco","osc"),e("svf","filter"),e("adsr","env"),e("vca","amp"),e("stereo_output","out"),e("offset","pitch_knob"),e("offset","gate_knob"),e("offset","attack_knob"),e("offset","decay_knob"),e("offset","sustain_knob"),e("offset","release_knob"),e("offset","pw_knob"),e("offset","detune_knob"),e("offset","cutoff_knob"),e("offset","resonance_knob"),e("offset","filter_env_knob"),t("pitch_knob.out","osc.voct"),t("pw_knob.out","osc.pw"),t("detune_knob.out","osc.fm"),t("gate_knob.out","env.gate"),t("attack_knob.out","env.attack"),t("decay_knob.out","env.decay"),t("sustain_knob.out","env.sustain"),t("release_knob.out","env.release"),t("osc.saw","filter.in"),t("filter.lp","amp.in"),t("cutoff_knob.out","filter.cutoff"),t("resonance_knob.out","filter.res"),t("env.env","amp.cv"),t("amp.out","out.left"),t("amp.out","out.right");const o=i=>Math.log10(Math.max(1,i))/4,r=i=>Math.log10(i/20)/3;console.log("Setting initial knob values..."),n.set_param("attack_knob",0,o(10)),n.set_param("decay_knob",0,o(200)),n.set_param("sustain_knob",0,.5),n.set_param("release_knob",0,o(300)),n.set_param("gate_knob",0,0),n.set_param("pitch_knob",0,0),n.set_param("pw_knob",0,.5),n.set_param("detune_knob",0,0),n.set_param("cutoff_knob",0,r(2e3)),n.set_param("resonance_knob",0,.3),n.set_param("filter_env_knob",0,0),console.log("Setting output module..."),n.set_output("out"),console.log("Compiling patch..."),n.compile(),console.log("Synth patch created successfully"),console.log("Modules:",n.module_count()),console.log("Cables:",n.cable_count())}function oe(n){const e=n.createScriptProcessor(512,0,2);return e.onaudioprocess=t=>{if(!u||!T){const o=t.outputBuffer.getChannelData(0),r=t.outputBuffer.getChannelData(1);o.fill(0),r.fill(0);return}try{const o=u.process_block(512),r=t.outputBuffer.getChannelData(0),i=t.outputBuffer.getChannelData(1),a=parseFloat(document.getElementById("volume").value)/5;for(let b=0;b<512;b++)r[b]=o[b*2]*a,i[b]=o[b*2+1]*a,q[M]=r[b],M=(M+1)%q.length}catch(o){console.error("Audio processing error:",o)}},e}async function _e(){if(!w)try{w=new AudioContext({sampleRate:44100}),w.state==="suspended"&&await w.resume(),u=new N(w.sampleRate),console.log("Engine created at",w.sampleRate,"Hz"),re(u),P=oe(w),P.connect(w.destination),T=!0,C.textContent="Audio Running",C.disabled=!0,y.textContent="Audio running - Play the keyboard!",requestAnimationFrame(z)}catch(n){y.className="status error";const e=n instanceof Error?n.message:String(n);y.textContent=`Audio error: ${e}`,console.error("Failed to start audio:",n)}}function z(){if(!T)return;f.fillStyle="#0a0a1a",f.fillRect(0,0,p.width,p.height),f.strokeStyle="#7b68ee",f.lineWidth=2,f.beginPath();const n=p.width/q.length;let e=0;for(let t=0;t<q.length;t++){const r=(1-q[(M+t)%q.length])*p.height/2;t===0?f.moveTo(e,r):f.lineTo(e,r),e+=n}f.stroke(),f.strokeStyle="#333",f.lineWidth=1,f.beginPath(),f.moveTo(0,p.height/2),f.lineTo(p.width,p.height/2),f.stroke(),requestAnimationFrame(z)}function $(n){if(!u||h.has(n))return;h.add(n);try{const t=(n-60)/12;u.set_param("pitch_knob",0,t),u.set_param("gate_knob",0,5),console.log("Note on:",n,"V/Oct:",t.toFixed(3))}catch(t){console.error("Note on error:",t)}const e=document.querySelector(`[data-note="${n}"]`);e&&e.classList.add("active")}function D(n){if(!u||!h.has(n))return;if(h.delete(n),h.size===0)try{u.set_param("gate_knob",0,0),console.log("Note off:",n,"(gate released)")}catch(t){console.error("Note off error:",t)}else{const t=Math.max(...h),o=(t-60)/12;u.set_param("pitch_knob",0,o),console.log("Note off:",n,"(pitch changed to",t,")")}const e=document.querySelector(`[data-note="${n}"]`);e&&e.classList.remove("active")}function ie(){const n={a:60,w:61,s:62,e:63,d:64,f:65,t:66,g:67,y:68,h:69,u:70,j:71,k:72};document.addEventListener("keydown",t=>{if(t.repeat)return;const o=n[t.key.toLowerCase()];o!==void 0&&$(o)}),document.addEventListener("keyup",t=>{const o=n[t.key.toLowerCase()];o!==void 0&&D(o)}),document.getElementById("keyboard").addEventListener("mousedown",t=>{const o=t.target.closest(".key");if(o){const r=parseInt(o.getAttribute("data-note"));$(r)}}),document.addEventListener("mouseup",()=>{h.forEach(t=>D(t))})}function ce(){const n=(r,i)=>{const c=document.getElementById(r),a=document.getElementById(r+"Value"),b=()=>{const v=parseFloat(c.value);a&&(a.textContent=v.toFixed(v<10?2:0)),i(v)};c.addEventListener("input",b),b()};n("volume",()=>{});const e=document.getElementById("waveform");e.addEventListener("change",()=>{te(e.value)});const t=r=>Math.log10(Math.max(1,r))/4,o=r=>Math.log10(r/20)/3;n("attack",r=>{u&&u.set_param("attack_knob",0,t(r))}),n("decay",r=>{u&&u.set_param("decay_knob",0,t(r))}),n("sustain",r=>{u&&u.set_param("sustain_knob",0,r)}),n("release",r=>{u&&u.set_param("release_knob",0,t(r))}),n("pulseWidth",r=>{u&&u.set_param("pw_knob",0,r)}),n("detune",r=>{const i=r/1200;u&&u.set_param("detune_knob",0,i)}),n("cutoff",r=>{u&&u.set_param("cutoff_knob",0,o(r))}),n("resonance",r=>{u&&u.set_param("resonance_knob",0,r)}),n("filterEnv",r=>{const i=o(r+20)-o(20);u&&u.set_param("filter_env_knob",0,i)})}async function se(){console.log("Initializing Quiver Browser Synth..."),await ne(),ie(),ce(),C.addEventListener("click",_e)}se();
